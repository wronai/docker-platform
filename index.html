<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Vault Project Explorer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <style>
        body { padding: 20px; }
        #file-explorer { max-height: 80vh; overflow-y: auto; }
        #file-content { padding: 20px; border-left: 1px solid #ddd; max-height: 90vh; overflow-y: auto; }
        .file-item { cursor: pointer; padding: 5px; }
        .file-item:hover { background-color: #f8f9fa; }
        .dir-item { font-weight: bold; }
        .markdown-body { max-width: 100%; margin: 0; }
        .spinner-border { width: 1.5rem; height: 1.5rem; }
        .breadcrumb { background-color: #f8f9fa; padding: 0.75rem 1rem; border-radius: 0.25rem; }
        .file-preview { margin-bottom: 2rem; }
        pre { background-color: #f6f8fa; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
        code { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row mb-3">
            <div class="col-12">
                <h1>Media Vault Project Explorer</h1>
                <p class="text-muted">Project: /home/tom/github/wronai/docker-platform</p>
                <nav aria-label="breadcrumb">
                    <ol id="breadcrumb" class="breadcrumb">
                        <li class="breadcrumb-item active" aria-current="page">/</li>
                    </ol>
                </nav>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">File Explorer</h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="file-explorer" class="list-group list-group-flush">
                            <div class="list-group-item">
                                <div class="spinner-border spinner-border-sm text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                Loading file structure...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">File Content</h5>
                        <span id="file-count" class="badge bg-secondary"></span>
                    </div>
                    <div id="file-content" class="card-body p-0">
                        <div class="p-3">
                            <h2>Welcome to Media Vault Project Explorer</h2>
                            <p>Select a file from the explorer to view its contents.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.2.12/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    return hljs.highlight(lang, code).value;
                }
                return hljs.highlightAuto(code).value;
            },
            gfm: true,
            breaks: true,
            smartLists: true,
            smartypants: true
        });
        // Project files and their content with actual paths and content
        const PROJECT_FILES = {
            // Root directory files
            "README.md": `# Media Vault Platform

A comprehensive media management platform with AI-powered analysis and organization.

## Features
- Media organization and categorization
- AI-powered content analysis
- User authentication and authorization
- Admin dashboard for management
- Scalable microservices architecture

## Getting Started

1. Clone the repository
2. Run \`docker-compose up -d\`
3. Access the admin panel at http://localhost:3000
`,

            "docker-compose.yml": `version: '3.8'

services:
  # Keycloak for authentication
  keycloak:
    image: bitnami/keycloak:26.2.5
    environment:
      - KEYCLOAK_DATABASE_HOST=postgresql
      - KEYCLOAK_DATABASE_NAME=keycloak
      - KEYCLOAK_DATABASE_USER=keycloak
      - KEYCLOAK_DATABASE_PASSWORD=keycloak
      - KEYCLOAK_ADMIN_USER=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin123
    ports:
      - "8082:8080"

  # Media Vault API
  media-vault-api:
    build: ./media-vault-backend
    ports:
      - "8080:8080"
    environment:
      - DB_HOST=postgres
      - DB_NAME=mediavault
      - DB_USER=mediavault
      - DB_PASSWORD=mediavault

  # Media Vault Admin UI
  media-vault-admin:
    build: ./media-vault-admin
    ports:
      - "3000:80"
    environment:
      - API_URL=http://media-vault-api:8080
`,

            "package.json": `{
  "name": "media-vault-platform",
  "version": "1.0.0",
  "description": "Media Vault Platform - Comprehensive media management solution",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "morgan": "^1.10.0"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}`,

            "server.js": `const express = require('express');
const fs = require('fs');
const path = require('path');
const cors = require('cors');
const morgan = require('morgan');

const app = express();
const PORT = 3000;

// Middleware
app.use(cors());
app.use(morgan('dev'));
app.use(express.static('.'));

// Start server
app.listen(PORT, () => {
    console.log(\`Server is running on http://localhost:${PORT}\`);
});`,

            // Subdirectories
            "media-vault-admin/package.json": `{
  "name": "media-vault-admin",
  "version": "1.0.0",
  "private": true,
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.10.0",
    "@mui/material": "^5.13.0",
    "@emotion/react": "^11.10.6",
    "@emotion/styled": "^11.10.6"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  }
}`,

            "media-vault-backend/go.mod": `module github.com/wronai/media-vault-backend

go 1.20

require (
	github.com/gin-gonic/gin v1.9.0
	github.com/joho/godotenv v1.5.1
	gorm.io/driver/postgres v1.5.0
	gorm.io/gorm v1.24.7-0.20230306060331-85eaf9eeda11
)
`,

            "media-vault-analyzer/requirements.txt": `flask==2.2.3
pillow==9.5.0
numpy==1.24.3
opencv-python-headless==4.7.0.72
tensorflow==2.12.0
python-dotenv==1.0.0
`
        };

        // File system structure with proper paths
        const FILE_SYSTEM = {
            name: "docker-platform",
            path: "",
            type: "directory",
            children: [
                {
                    name: "media-vault-admin",
                    path: "media-vault-admin",
                    type: "directory",
                    children: [
                        {
                            name: "src",
                            path: "media-vault-admin/src",
                            type: "directory",
                            children: [
                                { name: "App.js", path: "media-vault-admin/src/App.js", type: "file" },
                                { name: "index.js", path: "media-vault-admin/src/index.js", type: "file" },
                                { 
                                    name: "components",
                                    path: "media-vault-admin/src/components",
                                    type: "directory",
                                    children: [
                                        { name: "Dashboard.js", path: "media-vault-admin/src/components/Dashboard.js", type: "file" },
                                        { name: "Login.js", path: "media-vault-admin/src/components/Login.js", type: "file" }
                                    ]
                                }
                            ]
                        },
                        { name: "package.json", path: "media-vault-admin/package.json", type: "file" },
                        { name: "Dockerfile", path: "media-vault-admin/Dockerfile", type: "file" }
                    ]
                },
                {
                    name: "media-vault-backend",
                    path: "media-vault-backend",
                    type: "directory",
                    children: [
                        { name: "main.go", path: "media-vault-backend/main.go", type: "file" },
                        { name: "go.mod", path: "media-vault-backend/go.mod", type: "file" },
                        { name: "go.sum", path: "media-vault-backend/go.sum", type: "file" },
                        { name: "Dockerfile", path: "media-vault-backend/Dockerfile", type: "file" }
                    ]
                },
                {
                    name: "media-vault-analyzer",
                    path: "media-vault-analyzer",
                    type: "directory",
                    children: [
                        { name: "app.py", path: "media-vault-analyzer/app.py", type: "file" },
                        { name: "requirements.txt", path: "media-vault-analyzer/requirements.txt", type: "file" },
                        { name: "Dockerfile", path: "media-vault-analyzer/Dockerfile", type: "file" }
                    ]
                },
                { name: "README.md", path: "README.md", type: "file" },
                { name: "docker-compose.yml", path: "docker-compose.yml", type: "file" },
                { name: "package.json", path: "package.json", type: "file" },
                { name: "server.js", path: "server.js", type: "file" }
            ]
        };

        // Current path state
        let currentPath = '';
        let currentFile = null;

        // Helper function to get file extension
        function getFileExtension(filename) {
            return filename.split('.').pop().toLowerCase();
        }

        // Helper function to get file icon
        function getFileIcon(filename) {
            const ext = getFileExtension(filename);
            const icons = {
                'js': 'bi-file-earmark-code',
                'py': 'bi-file-earmark-code',
                'go': 'bi-file-earmark-code',
                'json': 'bi-file-earmark-code',
                'md': 'bi-markdown',
                'yml': 'bi-file-earmark-text',
                'yaml': 'bi-file-earmark-text',
                'txt': 'bi-file-earmark-text',
                'html': 'bi-file-earmark-code',
                'css': 'bi-file-earmark-code',
                'sh': 'bi-terminal',
                'dockerfile': 'bi-box',
                'gitignore': 'bi-git',
                'env': 'bi-gear',
                'lock': 'bi-lock',
                'png': 'bi-file-image',
                'jpg': 'bi-file-image',
                'jpeg': 'bi-file-image',
                'gif': 'bi-file-image',
                'svg': 'bi-file-image',
                'pdf': 'bi-file-pdf'
            };
            return icons[ext] || 'bi-file-earmark';
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Get file content
        function getFileContent(filePath) {
            return PROJECT_FILES[filePath] || `# File not found or not supported for preview\n\nFile: ${filePath}`;
        }

        // Render markdown content
        function renderMarkdown(content) {
            return marked.parse(content);
        }

        // Render code with syntax highlighting
        function renderCode(content, language = '') {
            const code = document.createElement('pre');
            code.className = language ? `language-${language}` : '';
            code.innerHTML = `<code>${hljs.highlightAuto(content, language ? [language] : undefined).value}</code>`;
            return code.outerHTML;
        }

        // Render file content based on type
        function renderFileContent(content, filename) {
            const ext = getFileExtension(filename);
            
            if (filename.endsWith('.md')) {
                return `<div class="markdown-body">${renderMarkdown(content)}</div>`;
            }
            
            if (['js', 'py', 'go', 'json', 'yaml', 'yml', 'sh', 'html', 'css', 'dockerfile'].includes(ext)) {
                const languageMap = {
                    'js': 'javascript',
                    'py': 'python',
                    'go': 'go',
                    'json': 'json',
                    'yaml': 'yaml',
                    'yml': 'yaml',
                    'sh': 'bash',
                    'html': 'html',
                    'css': 'css',
                    'dockerfile': 'dockerfile'
                };
                return renderCode(content, languageMap[ext] || '');
            }
            
            // For other file types, show as plain text
            return `<pre><code>${content}</code></pre>`;
        }

        // Update breadcrumb navigation
        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = '';
            
            const parts = path.split('/').filter(p => p);
            let currentPath = '';
            
            // Add root
            const rootItem = document.createElement('li');
            rootItem.className = 'breadcrumb-item';
            rootItem.textContent = 'root';
            rootItem.onclick = () => navigateTo('');
            breadcrumb.appendChild(rootItem);
            
            // Add path parts
            parts.forEach((part, index) => {
                currentPath += (currentPath ? '/' : '') + part;
                const isLast = index === parts.length - 1;
                
                const separator = document.createElement('li');
                separator.className = 'breadcrumb-item';
                separator.textContent = '/';
                breadcrumb.appendChild(separator);
                
                const item = document.createElement('li');
                item.className = `breadcrumb-item ${isLast ? 'active' : ''}`;
                item.textContent = part;
                if (!isLast) {
                    item.style.cursor = 'pointer';
                    item.onclick = () => navigateTo(currentPath);
                }
                breadcrumb.appendChild(item);
            });
        }

        // Navigate to a directory
        function navigateTo(path) {
            currentPath = path;
            currentFile = null;
            renderFileExplorer(path);
            updateBreadcrumb(path);
        }

        // Open a file
        function openFile(filePath) {
            currentFile = filePath;
            const content = getFileContent(filePath);
            const fileContent = document.getElementById('file-content');
            
            document.getElementById('file-count').textContent = filePath.split('/').pop();
            
            fileContent.innerHTML = `
                <div class="file-preview">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>${filePath.split('/').pop()}</h5>
                        <span class="badge bg-secondary">${getFileExtension(filePath).toUpperCase()}</span>
                    </div>
                    <div class="file-content">
                        ${renderFileContent(content, filePath)}
                    </div>
                </div>
            `;
            
            // Apply syntax highlighting
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        }

        // Render file explorer
        function renderFileExplorer(path) {
            const explorer = document.getElementById('file-explorer');
            let content = '';
            
            // Find the current directory in the file system
            let currentDir = FILE_SYSTEM;
            if (path) {
                const parts = path.split('/').filter(p => p);
                for (const part of parts) {
                    const found = currentDir.children.find(item => item.name === part && item.type === 'directory');
                    if (found) {
                        currentDir = found;
                    } else {
                        // If path not found, show root
                        currentDir = FILE_SYSTEM;
                        break;
                    }
                }
            }
            
            // Add parent directory link if not at root
            if (path) {
                const parentPath = path.split('/').slice(0, -1).join('/');
                content += `
                    <div class="list-group-item list-group-item-action" onclick="navigateTo('${parentPath}')">
                        <i class="bi bi-folder2-open me-2"></i> ..
                    </div>
                `;
            }
            
            // Add directories
            const dirs = currentDir.children.filter(item => item.type === 'directory').sort((a, b) => a.name.localeCompare(b.name));
            dirs.forEach(dir => {
                content += `
                    <div class="list-group-item list-group-item-action" onclick="navigateTo('${dir.path}')">
                        <i class="bi bi-folder me-2"></i> ${dir.name}
                    </div>
                `;
            });
            
            // Add files
            const files = currentDir.children.filter(item => item.type === 'file').sort((a, b) => a.name.localeCompare(b.name));
            files.forEach(file => {
                const icon = getFileIcon(file.name);
                const isActive = currentFile === file.path ? 'active' : '';
                content += `
                    <div class="list-group-item list-group-item-action ${isActive}" onclick="openFile('${file.path}')">
                        <i class="bi ${icon} me-2"></i> ${file.name}
                    </div>
                `;
            });
            
            // Update UI
            explorer.innerHTML = content;
            document.getElementById('file-count').textContent = `${dirs.length} dirs, ${files.length} files`;
            
            // If no files or directories, show message
            if (dirs.length === 0 && files.length === 0) {
                explorer.innerHTML = `
                    <div class="list-group-item text-muted">
                        <i class="bi bi-folder-x me-2"></i> Empty directory
                    </div>
                `;
            }
        }

        // Initialize the file explorer
        function initFileExplorer() {
            // Add Bootstrap Icons
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css';
            document.head.appendChild(link);
            
            // Initial render
            navigateTo('');
            
            // Show welcome message in file content area
            const welcomeContent = `
                <div class="p-4">
                    <h2><i class="bi bi-collection me-2"></i>Media Vault Project Explorer</h2>
                    <p class="lead">Navigate through the project files using the explorer on the left.</p>
                    <hr>
                    <h5>Project Structure:</h5>
                    <ul>
                        <li><strong>media-vault-admin/</strong> - React-based admin dashboard</li>
                        <li><strong>media-vault-backend/</strong> - Go backend service</li>
                        <li><strong>media-vault-analyzer/</strong> - Python media analysis service</li>
                    </ul>
                    <h5>Key Files:</h5>
                    <ul>
                        <li><code>docker-compose.yml</code> - Main service configuration</li>
                        <li><code>README.md</code> - Project documentation</li>
                        <li><code>server.js</code> - Development server</li>
                    </ul>
                </div>
            `;
            document.getElementById('file-content').innerHTML = welcomeContent;
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initFileExplorer);
            try {
                const response = await fetch(`/api/files?path=${encodeURIComponent(path)}`);
                if (!response.ok) throw new Error('Failed to fetch directory');
                return await response.json();
            } catch (error) {
                console.error('Error fetching file system:', error);
                return null;
            }
        }

        async function buildFileSystem(path = '') {
            const data = await fetchFileSystem(path);
            if (!data) return null;

            // Convert the API response to our file system format
            const node = {
                name: data.name || '',
                path: path,
                type: data.type,
                children: []
            };

            if (data.type === 'directory' && data.children) {
                for (const child of data.children) {
                    const childPath = path ? `${path}/${child.name}` : child.name;
                    const childNode = await buildFileSystem(childPath);
                    if (childNode) {
                        node.children.push(childNode);
                    }
                }
            }

            return node;
        }

        // Initialize file system
        let fileSystem = null;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                fileSystem = await buildFileSystem();
                if (!fileSystem) {
                    throw new Error('Failed to load file system');
                }
                
                // Show directory structure on the left
                renderDirectory(fileSystem, []);
                updateBreadcrumb([]);
                
                // Load and display all files on the right
                const allFiles = findAllFiles(fileSystem);
                const contentDiv = document.getElementById('file-content');
                let currentIndex = 0;
                
                async function loadAndShowFiles() {
                    if (currentIndex >= allFiles.length) {
                        contentDiv.innerHTML += `
                            <div class="alert alert-success mt-3">
                                <strong>All files loaded!</strong> ${allFiles.length} files processed.
                            </div>
                        `;
                        return;
                    }
                    
                    const file = allFiles[currentIndex];
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'file-preview mb-4 border-bottom pb-3';
                    fileDiv.id = `file-${currentIndex}`;
                    
                    // Add loading indicator
                    fileDiv.innerHTML = `
                        <div class="file-header d-flex justify-content-between align-items-center">
                            <h4>${file.path}</h4>
                            <span class="badge bg-secondary">${currentIndex + 1}/${allFiles.length}</span>
                        </div>
                        <div class="file-loading">
                            <div class="spinner-border spinner-border-sm" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            Loading...
                        </div>
                    `;
                    
                    contentDiv.appendChild(fileDiv);
                    fileDiv.scrollIntoView({ behavior: 'smooth' });
                    
                    try {
                        // Fetch actual file content
                        const response = await fetch(`/api/file?path=${encodeURIComponent(file.path)}`);
                        if (response.ok) {
                            const content = await response.text();
                            
                            if (file.name.endsWith('.md')) {
                                fileDiv.querySelector('.file-loading').innerHTML = marked.parse(content);
                            } else {
                                const pre = document.createElement('pre');
                                const code = document.createElement('code');
                                code.className = `language-${file.name.split('.').pop() || 'text'}`;
                                code.textContent = content;
                                pre.appendChild(code);
                                fileDiv.querySelector('.file-loading').innerHTML = '';
                                fileDiv.querySelector('.file-loading').appendChild(pre);
                                hljs.highlightElement(code);
                            }
                        } else {
                            throw new Error('Failed to load file');
                        }
                    } catch (error) {
                        console.error(`Error loading file ${file.path}:`, error);
                        fileDiv.querySelector('.file-loading').innerHTML = `
                            <div class="alert alert-warning">
                                Could not load file: ${file.path}
                            </div>
                        `;
                    }
                    
                    currentIndex++;
                    // Load next file with a small delay
                    setTimeout(loadAndShowFiles, 50);
                }
                
                // Clear and start loading files
                contentDiv.innerHTML = '';
                loadAndShowFiles();
                
            } catch (error) {
                console.error('Error initializing file explorer:', error);
                document.getElementById('file-content').innerHTML = `
                    <div class="alert alert-danger">
                        <h4>Error loading file system</h4>
                        <p>${error.message}</p>
                        <p>Make sure you're running this page through a local server with the API endpoints:</p>
                        <ul>
                            <li><code>GET /api/files?path={path}</code> - List directory contents</li>
                            <li><code>GET /api/file?path={path}</code> - Get file contents</li>
                        </ul>
                    </div>
                `;
            }
        });

        // Function to find all files in the file system
        function findAllFiles(node, path = []) {
            let files = [];
            
            if (node.type === 'file') {
                return [{
                    path: [...path, node.name].join('/'),
                    name: node.name,
                    fullPath: [...path, node.name].join('/')
                }];
            }
            
            if (node.children) {
                node.children.forEach(child => {
                    files = files.concat(findAllFiles(child, [...path, node.name]));
                });
            }
            
            return files;
        }

        // Function to render file content
        function renderFileContent(file) {
            const contentDiv = document.getElementById('file-content');
            const content = PROJECT_FILES[file.path] || `// No preview available for ${file.name}`;
            
            if (file.name.endsWith('.md')) {
                contentDiv.innerHTML = marked.parse(content);
            } else {
                const pre = document.createElement('pre');
                const code = document.createElement('code');
                code.className = `language-${file.name.split('.').pop() || 'text'}`;
                code.textContent = content;
                pre.appendChild(code);
                contentDiv.innerHTML = `<h3>${file.path}</h3>`;
                contentDiv.appendChild(pre);
            }
            
            // Apply syntax highlighting
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Show directory structure on the left
            renderDirectory(fileSystem, []);
            updateBreadcrumb([]);
            
            // Load and display all files on the right
            const allFiles = findAllFiles(fileSystem);
            const contentDiv = document.getElementById('file-content');
            let currentIndex = 0;
            
            function showNextFile() {
                if (currentIndex >= allFiles.length) {
                    // All files loaded
                    contentDiv.innerHTML += `
                        <div class="alert alert-success mt-3">
                            <strong>All files loaded!</strong> ${allFiles.length} files processed.
                        </div>
                    `;
                    return;
                }
                
                const file = allFiles[currentIndex];
                const fileDiv = document.createElement('div');
                fileDiv.className = 'file-preview mb-4 border-bottom pb-3';
                fileDiv.id = `file-${currentIndex}`;
                
                // Add loading indicator
                fileDiv.innerHTML = `
                    <div class="file-header d-flex justify-content-between align-items-center">
                        <h4>${file.path}</h4>
                        <span class="badge bg-secondary">${currentIndex + 1}/${allFiles.length}</span>
                    </div>
                    <div class="file-loading">
                        <div class="spinner-border spinner-border-sm" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        Loading...
                    </div>
                `;
                
                contentDiv.appendChild(fileDiv);
                
                // Scroll to the current file
                fileDiv.scrollIntoView({ behavior: 'smooth' });
                
                // Simulate loading delay for better UX
                setTimeout(() => {
                    // Update with actual content
                    const content = PROJECT_FILES[file.path] || `// No preview available for ${file.name}`;
                    
                    if (file.name.endsWith('.md')) {
                        fileDiv.querySelector('.file-loading').innerHTML = marked.parse(content);
                    } else {
                        const pre = document.createElement('pre');
                        const code = document.createElement('code');
                        code.className = `language-${file.name.split('.').pop() || 'text'}`;
                        code.textContent = content;
                        pre.appendChild(code);
                        fileDiv.querySelector('.file-loading').innerHTML = '';
                        fileDiv.querySelector('.file-loading').appendChild(pre);
                        
                        // Apply syntax highlighting
                        hljs.highlightElement(code);
                    }
                    
                    // Show next file
                    currentIndex++;
                    showNextFile();
                }, 100); // Small delay for better UX
            }
            
            // Clear and start loading files
            contentDiv.innerHTML = '';
            showNextFile();
        });

        // Render directory contents
        function renderDirectory(node, path = []) {
            const explorer = document.getElementById('file-explorer');
            explorer.innerHTML = '';

            // Add parent directory link if not in root
            if (path.length > 0) {
                const parentPath = path.slice(0, -1);
                const parentItem = document.createElement('div');
                parentItem.className = 'list-group-item file-item';
                parentItem.innerHTML = 'ðŸ“ ..';
                parentItem.onclick = () => navigateTo(parentPath);
                explorer.appendChild(parentItem);
            }

            // Add directories first
            const directories = (node.children || []).filter(child => child.type === 'directory');
            const files = (node.children || []).filter(child => child.type === 'file');

            // Add directories
            directories.forEach(child => {
                const item = document.createElement('div');
                item.className = 'list-group-item file-item dir-item';
                item.innerHTML = `ðŸ“ ${child.name}`;
                item.onclick = () => navigateTo([...path, child.name]);
                explorer.appendChild(item);
            });

            // Add files
            files.forEach(child => {
                const item = document.createElement('div');
                item.className = 'list-group-item file-item';
                item.innerHTML = `ðŸ“„ ${child.name}`;
                item.onclick = () => navigateTo([...path, child.name]);
                explorer.appendChild(item);
            });

            // Update the current path display
            updateBreadcrumb(path);
        }

        // Render file content (used when clicking on files in the explorer)
        function renderFile(file) {
            const contentDiv = document.getElementById('file-content');
            contentDiv.innerHTML = `
                <div class="file-preview">
                    <h3>${file.path}</h3>
                    <div class="file-content">
                        ${file.name.endsWith('.md') ? 
                            marked.parse(PROJECT_FILES[file.path] || `// No content available for ${file.name}`) : 
                            `<pre><code class="language-${file.name.split('.').pop() || 'text'}">
                                ${PROJECT_FILES[file.path] || `// No preview available for ${file.name}`}
                            </code></pre>`
                        }
                    </div>
                </div>
            `;
            
            // Apply syntax highlighting
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        }

        // Update breadcrumb navigation
        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = '<li class="breadcrumb-item"><a href="#" onclick="navigateTo([])">/</a></li>';
            
            let currentPath = [];
            path.forEach((segment, index) => {
                currentPath.push(segment);
                const li = document.createElement('li');
                li.className = `breadcrumb-item ${index === path.length - 1 ? 'active' : ''}`;
                
                if (index < path.length - 1) {
                    const a = document.createElement('a');
                    a.href = '#';
                    a.onclick = (e) => {
                        e.preventDefault();
                        navigateTo(currentPath);
                    };
                    a.textContent = segment;
                    li.appendChild(a);
                } else {
                    li.setAttribute('aria-current', 'page');
                    li.textContent = segment;
                }
                
                breadcrumb.appendChild(li);
            });
        }

        // Navigate to path
        function navigateTo(path) {
            let currentNode = fileSystem;
            let currentPath = [];
            
            for (const segment of path) {
                const node = (currentNode.children || []).find(n => n.name === segment);
                if (!node) break;
                currentNode = node;
                currentPath.push(segment);
            }
            
            if (currentNode.type === 'directory') {
                renderDirectory(currentNode, currentPath);
                updateBreadcrumb(currentPath);
            } else if (currentNode.type === 'file') {
                // When clicking on a file, show only that file in the content area
                const contentDiv = document.getElementById('file-content');
                contentDiv.innerHTML = '';
                
                const fileDiv = document.createElement('div');
                fileDiv.className = 'file-preview';
                fileDiv.innerHTML = `
                    <div class="file-header">
                        <h3>${currentNode.path}</h3>
                    </div>
                    <div class="file-content">
                        ${currentNode.name.endsWith('.md') ? 
                            marked.parse(PROJECT_FILES[currentNode.path] || '') : 
                            `<pre><code class="language-${currentNode.name.split('.').pop() || 'text'}">
                                ${PROJECT_FILES[currentNode.path] || '// No content available'}
                            </code></pre>`
                        }
                    </div>
                `;
                contentDiv.appendChild(fileDiv);
                
                // Apply syntax highlighting
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            }
        }

        // Make navigateTo available globally for breadcrumb links
        window.navigateTo = navigateTo;
    </script>
</body>
</html>
